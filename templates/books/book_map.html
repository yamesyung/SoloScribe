{% extends "_base.html" %}

{% load static %}

{% block content %}
<head>
    <link rel="stylesheet" href="{% static 'css/books/book-map.css' %}">
     <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
     integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
     crossorigin=""/>
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster/dist/MarkerCluster.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster/dist/MarkerCluster.Default.css" />

     <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
     integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
     crossorigin=""></script>
    <script src="https://unpkg.com/leaflet.markercluster/dist/leaflet.markercluster.js"></script>
    <script src="https://unpkg.com/leaflet.markercluster.layersupport@2.0.1/dist/leaflet.markercluster.layersupport.js"></script>


</head>

<body>

    <div id="get-locations-container" class="{% if emptyLoc == 0 %}hidden{% endif %}">

        <div>Get location data from Open Street Map. <br>
            Rate is limited at one request per second. <br>
            At <span id="locCount"></span> unique locations found, estimated time to completion: <span id="locTimeM"></span> minutes.
        </div>


        <form action='/books/import/location/' method="post">
             {% csrf_token %}
             <br/>
             <button type="submit" value="Get location data" class="btn btn-secondary">Get location data</button>
        </form>
    </div>

         <div id="map" class="map-container" style="width: 1300px; height: 800px;"></div>


{{ locations|json_script:"locations_json" }}
<script>
    let emptyLoc = {{ emptyLoc|safe }};
    let bookMarkerPath = '{% static 'images/book-marker.png' %}';
    let bookMarkerClearPath = '{% static 'images/book-marker-clear.png' %}';
</script>

{% endblock content %}

{% block scripts %}
          {{ block.super }}
          <script src="{% static 'js/book/book-map.js' %}"></script>
{% endblock %}

</body>

