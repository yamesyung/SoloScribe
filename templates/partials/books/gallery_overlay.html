{% load static %}

{% if book %}

<div class="overlay-content" id="overlay-content">
    <button class="close-btn" onclick="closeOverlay()">X</button>

    <div style="display: flex; align-items: flex-start;">
            <!-- Left column: Title, Author, and Metadata -->
    <div style="flex: 2; margin-right: 20px;">

    <h2>{{ book.title }}</h2>
    {% if book.list_authors %}
        {% for author in book.list_authors %}
            <span class="contributor" style="font-size: 20px;" hx-get="/books/author-filter?contributor={{ author }}" hx-trigger="click" hx-target="#content-div" hx-swap="show:window:top">{{author}}</span>{% if not forloop.last %},{% endif %}
        {% endfor %}
    {% endif %}
    <br> <br>

    {% if book.rating_counts %}
        <span>Number of ratings: {{ book.rating_counts }}</span><br>
    {% endif %}

    {% if book.number_of_pages > 1 %}
        <span>Number of pages: {{ book.number_of_pages }}</span><br>
    {% endif %}

    {% if book.url %}
        <a href="{{ book.url }}" target=”_blank”>Goodreads link</a><br>
    {% endif %}

    {% if book.list_genres %}
        <span> Genres:</span>
        {% for genre in book.list_genres %}
            <span class="book-tag" hx-get="/books/genre-filter?genre={{ genre }}" hx-trigger="click" hx-target="#content-div" hx-swap="show:window:top">{{genre}}</span>{% if not forloop.last %},{% endif %}
        {% endfor %}
    {% endif %} <br><br>

    {% with review=book.review_set.first %}
        <span>Bookshelf: {{ review.bookshelves }}</span><br>

        {% if review.date_read %}
            <span>Date read: {{ review.date_read }}</span><br>
        {% endif %}

    {% endwith %}
    <br> <br>
        </div>
            <!-- Right column: Image, Rating, Bookshelf, Date read -->
    <div style="flex: 1; margin-left: 30px; margin-bottom: 30px; display: flex; flex-direction: column;
  justify-content: center;
  align-items: center;">

        <div>
            <img src="{% static 'images/book-cover.png' %}" height="350">
        </div>

        {% with review=book.review_set.first %}
            {% if review.bookshelves == 'read' %}
                <div class="rating-stars" id="rating-content">
                        {% for rating in rating_range %}
                            <input type="radio"  name="rating" id="rs{{ rating }}" {% if review.rating == rating %} checked {% endif %}
                            hx-post="{% url 'rating_update' book.goodreads_id rating %}" hx-trigger="change" hx-swap="innerHTML"
                            hx-target="#rating-status-update" >
                            <label for="rs{{ rating }}">{{ rating }}</label>
                        {% endfor %}

                </div>
        <div id="rating-status-update"></div>
        <span hx-get="/books/rating-sidebar-update/" hx-trigger="change from:input[name=rating] delay:150ms" hx-target="#ratings-container" hx-swap="innerHTML" ></span>
            {% endif %}
        {% endwith %}
    </div>
    </div>
    {% if book.description %}
        <div id="book-description" style="font-size: 14px;">{{ book.description }}</div>
    {% endif %}

    <br>
</div>

<script>
    showOverlay();
</script>
{% endif %}